欢迎大家使用Shark，常见问题在这里解答，希望对大家有所帮助。

## 1、什么是Shark？

轻量级Mysql分库分表(Sharding)中间件，丰富的Sharding算法支持(2类4种分片算法)，能够方便DBA实现库的水平扩容和降 低数据迁移成本。Shark站在巨人的肩膀上(SpringJdbc)，采用与应用集成架构，放弃通用性，只为换取更好的执行性能与降低分布式环境下外 围系统的宕机风险。
关于更多Shark的介绍，请参考：https://github.com/gaoxianglong/shark/wiki/Shark%E7%AE%80%E4%BB%8B

## 2、怎么获取Shark的源码

Shark是一个开源项目，源码托管在github上，源代码仓库地址是：https://github.com/gaoxianglong/shark。 同时每次Shark发布正式版本和快照的时候，都会把源码打包，你可以从上面的下载地址中找到相关版本的源码。

## 3、RDBMS的数据库为什么需要做垂直分库、水平分区操作？

主要是为了解决单库性能瓶颈，充分利用分布式和集群的威力提升数据库读/写性能。关于互联网场景下常见的性能瓶颈：
- 大量的并发访问，导致单库出现难以承受的负载压力；
- 单表数据量过大，导致检索效率低下；

关于互联网当下的数据拆分过程，请参考：https://github.com/gaoxianglong/shark/wiki/%E4%BA%92%E8%81%94%E7%BD%91%E5%BD%93%E4%B8%8B%E7%9A%84%E6%95%B0%E6%8D%AE%E6%8B%86%E5%88%86%E8%BF%87%E7%A8%8B

## 4、为什么市面上更多的技术团队选择做Sharding而不做Mysql Cluster？

单纯从技术上来讲，Mysql Cluster仅仅只是一个数据库集群，它的优势只是扩展了DB的并发处理能力，但使用成本、维护成本相当高(中国会的人很少，用的人更少)。而 Sharding是一个成熟且实惠的方案，不仅可以解决DB的并发处理能力，同时还能够解决大数据情况下的读/写性能瓶颈。简单来说，前者是集群模式，而 后者是分布式模式，因此无论从任何一个角度来看，Sharding无疑是当下互联网最好的选择。

## 5、和其它sharding中间件相比，Shark的优势体现在哪里？

目前市面上Sharding中间件太多，应用集成架构鼻祖TDDL闭源，而其它成熟的更多是基于Proxy，在分布式场景下，多一个外围系统依赖就 意味着需要多承担一分风险，况且性能相对于应用集成架构直连数据库而言，网络连接带来的消耗也是一个问题。并且市面上大多数的Sharding中间件都会 附加很多看似“实用”的鸡肋功能，导致过多的代码，可读性、维护性不好。
Shark不考虑通用性，采用应用集成架构，站在巨人的肩膀上，只为换取更好的执行性能与降低分布式环境下外围系统的宕机风险。并且处于成本(人员成 本、物理资源成本)上的考虑，Shark有着较大优势，最重要的是，Shark的分片模型丰富，能够帮助DBA在较短时间内实现库的水平扩容和降低数 据迁移成本。
关于更多的对比细节，请参考：https://github.com/gaoxianglong/shark/wiki/%E7%9B%AE%E5%89%8D%E5%B8%82%E9%9D%A2%E4%B8%8A%E5%B8%B8%E8%A7%81%E7%9A%84%E4%B8%80%E4%BA%9BSharding%E4%B8%AD%E9%97%B4%E4%BB%B6%E4%BA%A7%E5%93%81%E5%AF%B9%E6%AF%94

## 6、如何使用和配置Shark的内置验证页面

在进行Sharding后，Shark提供有一个验证页面，能够方便开发、测试、运维人员对执行后的sql进行验证。
关于配置细节，请参考：https://github.com/gaoxianglong/shark/wiki/%E4%BD%BF%E7%94%A8%E5%92%8C%E9%85%8D%E7%BD%AEShark%E5%86%85%E7%BD%AE%E9%AA%8C%E8%AF%81%E9%A1%B5%E9%9D%A2

## 7、是否可以单独使用Shark的功能子集？

Shark简单易用，开发人员可以使用所有或者部分Shark的功能，如果你的应用还没有达到Sharding级别，那么你可以优先考虑使用Shark实现master/slave一主一从的读写分离操作。
关于读写分离配置，请参考：https://github.com/gaoxianglong/shark/wiki/Shark%E7%9A%84%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E9%85%8D%E7%BD%AE

## 8、Shark是否一定要依赖于SpringJdbc？

Shark诞生的初衷就是因为SpringJdbc，自然依赖于它。简单来说，Shark重写了JdbcTemplate，并使用了 Spring提供的AbstractRoutingDataSource作为动态数据源层。相信一直到最后，Shark都不会考虑与其它第三方持久层组 件集成，这主要是为了使Shark的核心代码更加纯粹。
关于Shark的架构模型，请参考：https://github.com/gaoxianglong/shark/wiki/Shark%E7%9A%84%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%9E%8B

## 9、Shark支持哪些分片算法？

Shark支持2类4种分片算法：
- 库内分片类型：
  - 片名连续的库内分片算法；
  - 非片名连续的库内分片算法；
- 一库一片类型：
  - 片名连续的一库一片算法；
  - 非片名连续的一库一片算法；

关于Shark的分片模型，请参考：https://github.com/gaoxianglong/shark/wiki/Shark%E7%9A%84%E5%88%86%E7%89%87%E6%A8%A1%E5%9E%8B

## 10、Shark所使用数据库连接池是否可随意替换？

你可以使用任意的数据库连接池，比如C3P0、DBCP、BoneCP、Druid等，Shark推荐使用Druid与C3P0，并且Shark对这2款数据库连接池产品提供了一定程度上的集成支持。

## 11、Shark是否支持分布式事物？

Shark不支持分布式事物，并且提示大家，能够避免引入分布式事物的，最好还是避免最好。如果实在要使用事物，那么强一致性的分布式事物肯定是不现实，也是不推荐的，但可以在业务层依赖MQ、异步操作的方式实现事物，保证最终一致性即可。
关于更多使用注意事项，请参考：https://github.com/gaoxianglong/shark/wiki/Shark%E7%9A%84%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9

## 12、如何配置分片规则？

有3个属性非常重要，如下所示：
```Xml
<!-- 分片开关 -->
<constructor-arg name="isShard" value="true" />
<!-- 分片模式,false为库内分片模式,true为一库一表分片模式 -->
<property name="shardMode" value="true" />
<!-- 片名是否连续,true为片名连续,false为非片名连续 -->
<property name="consistent" value="true" />
```

属性“shardMode”指定了分片类型，而属性“consistent”指定了分片方式。
关于片名连续的库内分片配置，请参考：https://github.com/gaoxianglong/shark/wiki/%E7%89%87%E5%90%8D%E8%BF%9E%E7%BB%AD%E7%9A%84%E5%BA%93%E5%86%85%E5%88%86%E7%89%87%E9%85%8D%E7%BD%AE
关于非片名连续的库内分片配置，请参考：https://github.com/gaoxianglong/shark/wiki/%E9%9D%9E%E7%89%87%E5%90%8D%E8%BF%9E%E7%BB%AD%E7%9A%84%E5%BA%93%E5%86%85%E5%88%86%E7%89%87%E9%85%8D%E7%BD%AE
关于片名连续的一库一片配置，请参考：https://github.com/gaoxianglong/shark/wiki/%E7%89%87%E5%90%8D%E8%BF%9E%E7%BB%AD%E7%9A%84%E4%B8%80%E5%BA%93%E4%B8%80%E7%89%87%E9%85%8D%E7%BD%AE
关于非片名连续的一库一片配置，请参考：https://github.com/gaoxianglong/shark/wiki/%E9%9D%9E%E7%89%87%E5%90%8D%E8%BF%9E%E7%BB%AD%E7%9A%84%E4%B8%80%E5%BA%93%E4%B8%80%E7%89%87%E9%85%8D%E7%BD%AE

## 13、路由条件是否必须是整型？

Shark不支持其它类型的路由条件，这就意味着路由条件必须是整型。当然在实际的开发过程中，查询条件往往比较复杂，不可能都是整型，那么在这种情况下，就需要在主表的基础上，构建一个反向索引表(也称之为二级索引表)。

## 14、构建反向索引表时，如何避免路由条件产生hash碰撞？

查询反向索引表获取主表的路由条件时，反向索引表的路由条件一般都是主键值做hash，为了避免产生hash碰撞，检索条件一般都会采用“select uid from tab where emailhash=? and email=?”。

## 15、数据库Sharding后，多机的Sequence如何解决？

如果在单库的情况下，开发人员可以使用主键自增，而多机场景下，将不再适用，Shark提供有解决生成全局唯一的SequenceId策略。
关于自动生成全局唯一的sequenceId，请参考：https://github.com/gaoxianglong/shark/wiki/%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E5%85%A8%E5%B1%80%E5%94%AF%E4%B8%80%E7%9A%84sequenceId

## 16、数据源配置文件能否自动生成？

为了避免手工配置出现错误的情况，Shark提供有自动生成核心配置文件和数据源配置文件的功能。
关于自动生成核心配置文件，请参考https://github.com/gaoxianglong/shark/wiki/%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90Shark%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6
关于自动生成数据源配置文件，请参考：https://github.com/gaoxianglong/shark/wiki/%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90druid%E6%95%B0%E6%8D%AE%E6%BA%90%E6%96%87%E4%BB%B6

## 17、配置maven时，Shark依赖哪些构件？

https://github.com/gaoxianglong/shark/wiki/Shark%E4%BE%9D%E8%B5%96%E7%9A%84maven%E6%9E%84%E4%BB%B6

## 18、如何获取Shark的构件？

https://github.com/gaoxianglong/shark/releases

## 19、为什么不建议多表联合查询

利用单表sql换来的优势有3点：
- 查询条件简单、易于开理解和维护；
- 扩展性极强；
- 缓存利用率高；

关于单表与多表的比较，请参考：https://github.com/gaoxianglong/shark/wiki/%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E5%BB%BA%E8%AE%AE%E5%A4%9A%E8%A1%A8%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2%EF%BC%9F

## 20、Sql如何与逻辑代码解耦？

Spring Jdbc并没有提供类似于MyBatis那样的Sql独立配置功能，而是缺省采用与逻辑代码耦合的方式。如果你希望解耦，那么Shark提供有支持。
关于解耦，请参考：https://github.com/gaoxianglong/shark/wiki/Sql%E4%B8%8E%E9%80%BB%E8%BE%91%E4%BB%A3%E7%A0%81%E7%9A%84%E8%A7%A3%E8%80%A6

## 21、如何设置子表的动态后缀规则？

https://github.com/gaoxianglong/shark/wiki/%E5%A6%82%E4%BD%95%E8%AE%BE%E7%BD%AE%E5%AD%90%E8%A1%A8%E7%9A%84%E5%8A%A8%E6%80%81%E5%90%8E%E7%BC%80%E8%A7%84%E5%88%99%EF%BC%9F

## 22、Shark依赖的JDK、Spring版本是多少？

- JDK>=1.7.0_15
- Spring>=3.2.13

## 23、对淘宝的Druid不熟悉怎么办？

https://github.com/alibaba/druid

## 24、Shark如何实现HA架构？
Shark缺省并没有提供HA机制，但是可以在生产或测试环境中，使用Keepalived、MHA等方式来实现高可用。如果业务场景不允许在主从切换过程中出现少量数据的丢失，那么建议使用MHA等方式。关于更多介绍，请参考：
https://github.com/gaoxianglong/shark/wiki/Shark%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0HA%EF%BC%9F

## 25、如何将shark的持有的数据源信息、sharding规则配置在资源配置中心中？
如果项目采用分布式架构进行部署后，配置文件始终是个大问题。开发人员往往希望当配置发生改变后，可以不重新启动程序便可动态加载。目前shark支持基于zookeeper作为集中式资源配置中心，一旦相关配置发生改变后，shark所持有的信息确保将是最新的，相对于本地配置文件，集中式资源配置中心将会大大降低维护成本和部署成本。请参考：
https://github.com/gaoxianglong/shark/wiki/基于zookeeper的集中式配置中心

## 26、如何捐赠？

Shark更多是利用牺牲了大家周末等业余时间完成的，如果你愿意以捐赠的形式作为推动项目进展的鼓励，我乐此不彼，不过不建议捐太多，意思意思就行，只为图个开心，当然如果你是土豪，那么则多多益善。捐赠者缺省将会留名，如果愿意低调请留言说明。
https://github.com/gaoxianglong/shark/wiki/%E5%A6%82%E4%BD%95%E6%8D%90%E8%B5%A0
